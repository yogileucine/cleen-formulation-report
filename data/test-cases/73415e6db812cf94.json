{"uid":"73415e6db812cf94","name":"Validate master data snapshot report for cleaning agent","fullName":"tests.scenarios.test_audit_portal_formulation_facility.TestAuditPortalLimits#test_validate_master_data_snapshot_report_cleaning_agent","historyId":"eb2dd2dcb0d68fe6a8c8d0eaca3a5017","time":{"start":1707717413443,"stop":1707717413615,"duration":172},"description":"This test case test API to validate the master data snapshot report for cleaning agent with excel file data","descriptionHtml":"<p>This test case test API to validate the master data snapshot report for cleaning agent with excel file data</p>\n","status":"failed","statusMessage":"AssertionError: There are 2 mismatched rows.\nassert False","statusTrace":"self = <test_audit_portal_formulation_facility.TestAuditPortalLimits object at 0x000001594D076E90>\n\n    @allure.title(\"Validate master data snapshot report for cleaning agent\")\n    @allure.description(\"This test case test API to validate the master data snapshot report for cleaning agent with \"\n                        \"excel file data\")\n    @allure.link(\"https://app.clickup.com/t/85zt9qzmh\")\n    @pytest.mark.validate_master_data_snapshot_report_cleaning_agent\n    def test_validate_master_data_snapshot_report_cleaning_agent(self):\n        data = {}\n        mismatched_rows = []\n        assert_flag = False\n    \n        data.update({\"sheet_name\": \"CleaningAgents\"})\n    \n        master_data_snapshot = self.get_audit_portal.test_config_new_master_data_snapshot_report(data)[\"response\"]\n    \n        if master_data_snapshot:\n            master_data_snapshot = pd.json_normalize(master_data_snapshot)\n    \n            columns_mapping = {\"externalId\": \"Id\", \"ade\": \"ADE(mg)\", \"amId\": \"AM Id\", \"ld50\": \"LD50 (mg/kg)\",\n                               \"name\": \"Name\", \"toxicology\": \"Toxicology Configured As (ADE/LD50)\",\n                               \"samplingRequired\": \"Take Samples during Validation (Yes/No)\"}\n    \n            excel_data = pd.read_excel(const.get_master_data(), sheet_name=\"cleaning agent\", usecols='A:G', nrows=3)\n            allure.attach(excel_data.to_html(), name=\"excel_data\", attachment_type=allure.attachment_type.HTML)\n    \n            api_df = master_data_snapshot[columns_mapping.keys()]\n            excel_df = excel_data[columns_mapping.values()]\n            allure.attach(excel_df.to_html(), name=\"excel_df\", attachment_type=allure.attachment_type.HTML)\n    \n            api_df_sorted = api_df.sort_values(by=list(columns_mapping.keys())).reset_index(drop=True)\n            excel_df_sorted = excel_df.sort_values(by=list(columns_mapping.values())).reset_index(drop=True)\n    \n            columns_to_convert = ['ade', 'ld50']\n            api_df_sorted[columns_to_convert] = api_df_sorted[columns_to_convert].apply(pd.to_numeric, errors='coerce')\n    \n            allure.attach(excel_df_sorted.to_html(), name=\"excel_df_sort\", attachment_type=allure.attachment_type.HTML)\n            allure.attach(api_df_sorted.to_html(), name=\"api_sort\", attachment_type=allure.attachment_type.HTML)\n    \n            api_df_sorted = api_df_sorted.rename(columns=columns_mapping)\n    \n            max_rows = max(len(api_df_sorted), len(excel_df_sorted))\n    \n            numeric_columns = api_df_sorted.select_dtypes(include=np.number).columns\n            string_columns = api_df_sorted.select_dtypes(include=object).columns\n    \n            for row in range(max_rows):\n                if row >= len(excel_df_sorted):\n                    mismatched_rows.append(row)\n                    continue\n    \n                for column in string_columns:\n                    api_value = api_df_sorted.loc[row, column]\n                    excel_value = excel_df_sorted.loc[row, column]\n                    comparison_successful = True\n                    comparison_successful &= compare_portal(api_value, excel_value, column, row)\n                    if not comparison_successful:\n                        mismatched_rows.append(row)\n                        break\n    \n                for column in numeric_columns:\n                    api_value = api_df_sorted.loc[row, column]\n                    excel_value = excel_df_sorted.loc[row, column]\n                    comparison_successful &= compare_portal(api_value, excel_value, column, row)\n                    if not comparison_successful:\n                        if math.isnan(api_value) and math.isnan(excel_value):\n                            continue\n                        mismatched_rows.append(row)\n                        break\n    \n            merged_df = pd.concat([api_df_sorted, excel_df_sorted], axis=1, keys=['API Data', 'Excel Data'])\n            allure.attach(merged_df.to_html(), name=\"merged_data\", attachment_type=allure.attachment_type.HTML)\n            allure.attach(str(mismatched_rows), name=\"mismatched_rows\", attachment_type=allure.attachment_type.HTML)\n    \n            if len(mismatched_rows) != 0:\n>               assert assert_flag, f\"There are {len(mismatched_rows)} mismatched rows.\"\nE               AssertionError: There are 2 mismatched rows.\nE               assert False\n\ntests\\scenarios\\test_audit_portal_formulation_facility.py:769: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"login","time":{"start":1707717401921,"stop":1707717402376,"duration":455},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentsCount":0,"shouldDisplayMessage":false,"hasContent":false,"attachmentStep":false,"stepsCount":0},{"name":"get_facility","time":{"start":1707717402376,"stop":1707717403251,"duration":875},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentsCount":0,"shouldDisplayMessage":false,"hasContent":false,"attachmentStep":false,"stepsCount":0}],"testStage":{"description":"This test case test API to validate the master data snapshot report for cleaning agent with excel file data","status":"failed","statusMessage":"AssertionError: There are 2 mismatched rows.\nassert False","statusTrace":"self = <test_audit_portal_formulation_facility.TestAuditPortalLimits object at 0x000001594D076E90>\n\n    @allure.title(\"Validate master data snapshot report for cleaning agent\")\n    @allure.description(\"This test case test API to validate the master data snapshot report for cleaning agent with \"\n                        \"excel file data\")\n    @allure.link(\"https://app.clickup.com/t/85zt9qzmh\")\n    @pytest.mark.validate_master_data_snapshot_report_cleaning_agent\n    def test_validate_master_data_snapshot_report_cleaning_agent(self):\n        data = {}\n        mismatched_rows = []\n        assert_flag = False\n    \n        data.update({\"sheet_name\": \"CleaningAgents\"})\n    \n        master_data_snapshot = self.get_audit_portal.test_config_new_master_data_snapshot_report(data)[\"response\"]\n    \n        if master_data_snapshot:\n            master_data_snapshot = pd.json_normalize(master_data_snapshot)\n    \n            columns_mapping = {\"externalId\": \"Id\", \"ade\": \"ADE(mg)\", \"amId\": \"AM Id\", \"ld50\": \"LD50 (mg/kg)\",\n                               \"name\": \"Name\", \"toxicology\": \"Toxicology Configured As (ADE/LD50)\",\n                               \"samplingRequired\": \"Take Samples during Validation (Yes/No)\"}\n    \n            excel_data = pd.read_excel(const.get_master_data(), sheet_name=\"cleaning agent\", usecols='A:G', nrows=3)\n            allure.attach(excel_data.to_html(), name=\"excel_data\", attachment_type=allure.attachment_type.HTML)\n    \n            api_df = master_data_snapshot[columns_mapping.keys()]\n            excel_df = excel_data[columns_mapping.values()]\n            allure.attach(excel_df.to_html(), name=\"excel_df\", attachment_type=allure.attachment_type.HTML)\n    \n            api_df_sorted = api_df.sort_values(by=list(columns_mapping.keys())).reset_index(drop=True)\n            excel_df_sorted = excel_df.sort_values(by=list(columns_mapping.values())).reset_index(drop=True)\n    \n            columns_to_convert = ['ade', 'ld50']\n            api_df_sorted[columns_to_convert] = api_df_sorted[columns_to_convert].apply(pd.to_numeric, errors='coerce')\n    \n            allure.attach(excel_df_sorted.to_html(), name=\"excel_df_sort\", attachment_type=allure.attachment_type.HTML)\n            allure.attach(api_df_sorted.to_html(), name=\"api_sort\", attachment_type=allure.attachment_type.HTML)\n    \n            api_df_sorted = api_df_sorted.rename(columns=columns_mapping)\n    \n            max_rows = max(len(api_df_sorted), len(excel_df_sorted))\n    \n            numeric_columns = api_df_sorted.select_dtypes(include=np.number).columns\n            string_columns = api_df_sorted.select_dtypes(include=object).columns\n    \n            for row in range(max_rows):\n                if row >= len(excel_df_sorted):\n                    mismatched_rows.append(row)\n                    continue\n    \n                for column in string_columns:\n                    api_value = api_df_sorted.loc[row, column]\n                    excel_value = excel_df_sorted.loc[row, column]\n                    comparison_successful = True\n                    comparison_successful &= compare_portal(api_value, excel_value, column, row)\n                    if not comparison_successful:\n                        mismatched_rows.append(row)\n                        break\n    \n                for column in numeric_columns:\n                    api_value = api_df_sorted.loc[row, column]\n                    excel_value = excel_df_sorted.loc[row, column]\n                    comparison_successful &= compare_portal(api_value, excel_value, column, row)\n                    if not comparison_successful:\n                        if math.isnan(api_value) and math.isnan(excel_value):\n                            continue\n                        mismatched_rows.append(row)\n                        break\n    \n            merged_df = pd.concat([api_df_sorted, excel_df_sorted], axis=1, keys=['API Data', 'Excel Data'])\n            allure.attach(merged_df.to_html(), name=\"merged_data\", attachment_type=allure.attachment_type.HTML)\n            allure.attach(str(mismatched_rows), name=\"mismatched_rows\", attachment_type=allure.attachment_type.HTML)\n    \n            if len(mismatched_rows) != 0:\n>               assert assert_flag, f\"There are {len(mismatched_rows)} mismatched rows.\"\nE               AssertionError: There are 2 mismatched rows.\nE               assert False\n\ntests\\scenarios\\test_audit_portal_formulation_facility.py:769: AssertionError","steps":[],"attachments":[{"uid":"5e84f99328d21dbb","name":"excel_data","source":"5e84f99328d21dbb.html","type":"text/html","size":952},{"uid":"780f994295f311c5","name":"excel_df","source":"780f994295f311c5.html","type":"text/html","size":952},{"uid":"3078dc677e705dde","name":"excel_df_sort","source":"3078dc677e705dde.html","type":"text/html","size":952},{"uid":"29831c1f50e88ef5","name":"api_sort","source":"29831c1f50e88ef5.html","type":"text/html","size":1304},{"uid":"cbd38920e95054c8","name":"merged_data","source":"cbd38920e95054c8.html","type":"text/html","size":2434},{"uid":"b88687e91810158e","name":"mismatched_rows","source":"b88687e91810158e.html","type":"text/html","size":6}],"parameters":[],"attachmentsCount":6,"shouldDisplayMessage":true,"hasContent":true,"attachmentStep":false,"stepsCount":0},"afterStages":[],"labels":[{"name":"tag","value":"validate_master_data_snapshot_report_cleaning_agent"},{"name":"tag","value":"run(order=1)"},{"name":"tag","value":"audit_portal_limits"},{"name":"tag","value":"scenario"},{"name":"tag","value":"second"},{"name":"parentSuite","value":"tests.scenarios"},{"name":"suite","value":"test_audit_portal_formulation_facility"},{"name":"subSuite","value":"TestAuditPortalLimits"},{"name":"host","value":"DESKTOP-ESU2KLG"},{"name":"thread","value":"10224-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.scenarios.test_audit_portal_formulation_facility"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[{"name":"https://app.clickup.com/t/85zt9qzmh","url":"https://app.clickup.com/t/85zt9qzmh","type":"link"}],"hidden":true,"retry":true,"extra":{"categories":[],"tags":["validate_master_data_snapshot_report_cleaning_agent","scenario","run(order=1)","audit_portal_limits","second"]},"source":"73415e6db812cf94.json","parameterValues":[]}