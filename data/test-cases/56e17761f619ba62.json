{"uid":"56e17761f619ba62","name":"Validate the equipments limits report","fullName":"tests.scenarios.test_audit_portal_formulation_facility.TestAuditPortalLimits#test_validate_equipments_limits_report_with_production","historyId":"f69a97d2656fffecb8cac49b581ea0c0","time":{"start":1708595230731,"stop":1708595232903,"duration":2172},"description":"This test test Api to validate the newly generated equipments limits report on audit portal with excel data when select previous production","descriptionHtml":"<p>This test test Api to validate the newly generated equipments limits report on audit portal with excel data when select previous production</p>\n","status":"broken","statusMessage":"KeyError: \"['Previous Production ID (A)', 'Previous API / Intermediate (A)', 'Next Production (B)', 'ADE (mg) (A)', 'Minimum Daily Dose (mg) (A)', 'Largest Daily Dose(mg) (B)', 'Shared Contact Surface Area (sqcm) (A-B)', 'Batch Size (kg) (B)'] not in index\"","statusTrace":"self = <test_audit_portal_formulation_facility.TestAuditPortalLimits object at 0x000001751D38D390>\n\n    @allure.title(\"Validate the equipments limits report\")\n    @allure.description(\"This test test Api to validate the newly generated equipments limits report on audit portal \"\n                        \"with excel data when select previous production\")\n    @allure.link(\"https://app.clickup.com/t/86cueu5qd\")\n    @pytest.mark.validate_equipments_limits_report_with_production\n    def test_validate_equipments_limits_report_with_production(self):\n        data = {}\n        columns_prod = [\"production_id\", \"equipment_id\"]\n        production = Excel.read_excel_columns(const.get_master_data(), \"config\", columns_prod)\n        production_id = production[\"production_id\"][0]\n        equipment_id = production[\"equipment_id\"][0]\n    \n        update_data = {\"production_external_id\": production_id, \"eq_external_id\": equipment_id}\n    \n        data.update(update_data)\n    \n        equipment_limit = self.get_audit_portal.test_generate_equipment_limits_report(data)\n    \n        equipment_limit = json.loads(equipment_limit[\"response\"])\n    \n        equipment_data = pd.json_normalize(equipment_limit[\"data\"])\n    \n        columns_mapping = {\"productionIdA\": \"Previous Production ID (A)\",\n                           \"apiNameA\": \"Previous API / Intermediate (A)\",\n                           \"productionIdB\": \"Next Production (B)\", \"pdeA\": \"ADE (mg) (A)\",\n                           \"minTdA\": \"Minimum Daily Dose (mg) (A)\", \"lddB\": \"Largest Daily Dose(mg) (B)\",\n                           \"sharedSurfaceArea\": \"Shared Contact Surface Area (sqcm) (A-B)\",\n                           \"toxicityL3\": \"sal_toxicity_mg_sqcm\", \"dosageL3\": \"sal_dosage_mg_sqcm\",\n                           \"generalL3\": \"sal_default_mg_sqcm\", \"minBsB\": \"Batch Size (kg) (B)\"}\n    \n        sheet_name = equipment_id + \"_equipmentwise_sal\"\n    \n        excel_data = pd.read_excel(const.get_master_data(), sheet_name=sheet_name, usecols='A:P', nrows=6)\n    \n        api_df = equipment_data[columns_mapping.keys()]\n>       excel_df = excel_data[columns_mapping.values()]\n\ntests\\scenarios\\test_audit_portal_formulation_facility.py:235: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\nvenv\\Lib\\site-packages\\pandas\\core\\frame.py:3767: in __getitem__\n    indexer = self.columns._get_indexer_strict(key, \"columns\")[1]\nvenv\\Lib\\site-packages\\pandas\\core\\indexes\\base.py:5877: in _get_indexer_strict\n    self._raise_if_missing(keyarr, indexer, axis_name)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = Index(['Equipment', 'Equipment ID', 'Previous Production ID\\n(A)',\n       'Previous Product ID\\n(A)', 'Previous API / ...Area (sqcm)\\n(A-B)', 'sal_toxicity_mg_sqcm',\n       'sal_dosage_mg_sqcm', 'sal_default_mg_sqcm'],\n      dtype='object')\nkey = Index(['Previous Production ID (A)', 'Previous API / Intermediate (A)',\n       'Next Production (B)', 'ADE (mg) (A)', ...al_toxicity_mg_sqcm',\n       'sal_dosage_mg_sqcm', 'sal_default_mg_sqcm', 'Batch Size (kg) (B)'],\n      dtype='object')\nindexer = array([-1, -1, -1, -1, -1, -1, -1, 13, 14, 15, -1], dtype=int64), axis_name = 'columns'\n\n    def _raise_if_missing(self, key, indexer, axis_name: str_t) -> None:\n        \"\"\"\n        Check that indexer can be used to return a result.\n    \n        e.g. at least one element was found,\n        unless the list of keys was actually empty.\n    \n        Parameters\n        ----------\n        key : list-like\n            Targeted labels (only used to show correct error message).\n        indexer: array-like of booleans\n            Indices corresponding to the key,\n            (with -1 indicating not found).\n        axis_name : str\n    \n        Raises\n        ------\n        KeyError\n            If at least one key was requested but none was found.\n        \"\"\"\n        if len(key) == 0:\n            return\n    \n        # Count missing values\n        missing_mask = indexer < 0\n        nmissing = missing_mask.sum()\n    \n        if nmissing:\n            # TODO: remove special-case; this is just to keep exception\n            #  message tests from raising while debugging\n            use_interval_msg = is_interval_dtype(self.dtype) or (\n                is_categorical_dtype(self.dtype)\n                # \"Index\" has no attribute \"categories\"  [attr-defined]\n                and is_interval_dtype(\n                    self.categories.dtype  # type: ignore[attr-defined]\n                )\n            )\n    \n            if nmissing == len(indexer):\n                if use_interval_msg:\n                    key = list(key)\n                raise KeyError(f\"None of [{key}] are in the [{axis_name}]\")\n    \n            not_found = list(ensure_index(key)[missing_mask.nonzero()[0]].unique())\n>           raise KeyError(f\"{not_found} not in index\")\nE           KeyError: \"['Previous Production ID (A)', 'Previous API / Intermediate (A)', 'Next Production (B)', 'ADE (mg) (A)', 'Minimum Daily Dose (mg) (A)', 'Largest Daily Dose(mg) (B)', 'Shared Contact Surface Area (sqcm) (A-B)', 'Batch Size (kg) (B)'] not in index\"\n\nvenv\\Lib\\site-packages\\pandas\\core\\indexes\\base.py:5941: KeyError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"login","time":{"start":1708595204784,"stop":1708595205507,"duration":723},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentsCount":0,"shouldDisplayMessage":false,"hasContent":false,"attachmentStep":false,"stepsCount":0},{"name":"get_facility","time":{"start":1708595205507,"stop":1708595206854,"duration":1347},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentsCount":0,"shouldDisplayMessage":false,"hasContent":false,"attachmentStep":false,"stepsCount":0}],"afterStages":[],"labels":[{"name":"tag","value":"validate_equipments_limits_report_with_production"},{"name":"tag","value":"run(order=1)"},{"name":"tag","value":"audit_portal_limits"},{"name":"tag","value":"scenario"},{"name":"tag","value":"second"},{"name":"parentSuite","value":"tests.scenarios"},{"name":"suite","value":"test_audit_portal_formulation_facility"},{"name":"subSuite","value":"TestAuditPortalLimits"},{"name":"host","value":"DESKTOP-ESU2KLG"},{"name":"thread","value":"24652-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.scenarios.test_audit_portal_formulation_facility"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[{"name":"https://app.clickup.com/t/86cueu5qd","url":"https://app.clickup.com/t/86cueu5qd","type":"link"}],"hidden":true,"retry":true,"extra":{"categories":[],"tags":["scenario","run(order=1)","audit_portal_limits","validate_equipments_limits_report_with_production","second"]},"source":"56e17761f619ba62.json","parameterValues":[]}