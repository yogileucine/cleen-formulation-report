{"uid":"a2faab0215bd9057","name":"Validate master data snapshot report for Productions","fullName":"tests.scenarios.test_audit_portal_formulation_facility.TestAuditPortalLimits#test_validate_master_data_snapshot_report_productions","historyId":"3408397e4f85bff8605d84adb72fee4b","time":{"start":1708258246153,"stop":1708258246402,"duration":249},"description":"This test case test API to validate the master data snapshot report for productions with excelfile data","descriptionHtml":"<p>This test case test API to validate the master data snapshot report for productions with excelfile data</p>\n","status":"broken","statusMessage":"KeyError: \"['Min BS (kg)'] not in index\"","statusTrace":"self = <test_audit_portal_formulation_facility.TestAuditPortalLimits object at 0x000002B7B519CB90>\n\n    @allure.title(\"Validate master data snapshot report for Productions\")\n    @allure.description(\"This test case test API to validate the master data snapshot report for productions with excel\"\n                        \"file data\")\n    @allure.link(\"https://app.clickup.com/t/85zt9qzdn\")\n    @pytest.mark.formulation\n    @pytest.mark.validate_master_data_snapshot_report_productions\n    def test_validate_master_data_snapshot_report_productions(self):\n        data = {}\n        mismatched_rows = []\n        assert_flag = False\n    \n        data.update({\"sheet_name\": \"Productions\"})\n    \n        master_data_snapshot = self.get_audit_portal.test_config_new_master_data_snapshot_report(data)[\"response\"]\n    \n        if master_data_snapshot:\n            master_data_snapshot = pd.json_normalize(master_data_snapshot)\n    \n            columns_mapping = {\"externalId\": \"Production Id\", \"batchSize\": \"Min BS (kg)\",\n                               \"productId\": \"Product Id\", \"totalInsolubleLoad\": \"Total Insoluble Load\"}\n    \n            excel_data = pd.read_excel(const.get_master_data(), sheet_name=\"production\", usecols='A:D', nrows=39)\n            allure.attach(excel_data.to_html(), name=\"excel_data\", attachment_type=allure.attachment_type.HTML)\n    \n            api_df = master_data_snapshot[columns_mapping.keys()]\n>           excel_df = excel_data[columns_mapping.values()]\n\ntests\\scenarios\\test_audit_portal_formulation_facility.py:416: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\nvenv\\Lib\\site-packages\\pandas\\core\\frame.py:3767: in __getitem__\n    indexer = self.columns._get_indexer_strict(key, \"columns\")[1]\nvenv\\Lib\\site-packages\\pandas\\core\\indexes\\base.py:5877: in _get_indexer_strict\n    self._raise_if_missing(keyarr, indexer, axis_name)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = Index(['Production Id', 'Product Id', 'Min BS (L)', 'Total Insoluble Load'], dtype='object')\nkey = Index(['Production Id', 'Min BS (kg)', 'Product Id', 'Total Insoluble Load'], dtype='object'), indexer = array([ 0, -1,  1,  3], dtype=int64), axis_name = 'columns'\n\n    def _raise_if_missing(self, key, indexer, axis_name: str_t) -> None:\n        \"\"\"\n        Check that indexer can be used to return a result.\n    \n        e.g. at least one element was found,\n        unless the list of keys was actually empty.\n    \n        Parameters\n        ----------\n        key : list-like\n            Targeted labels (only used to show correct error message).\n        indexer: array-like of booleans\n            Indices corresponding to the key,\n            (with -1 indicating not found).\n        axis_name : str\n    \n        Raises\n        ------\n        KeyError\n            If at least one key was requested but none was found.\n        \"\"\"\n        if len(key) == 0:\n            return\n    \n        # Count missing values\n        missing_mask = indexer < 0\n        nmissing = missing_mask.sum()\n    \n        if nmissing:\n            # TODO: remove special-case; this is just to keep exception\n            #  message tests from raising while debugging\n            use_interval_msg = is_interval_dtype(self.dtype) or (\n                is_categorical_dtype(self.dtype)\n                # \"Index\" has no attribute \"categories\"  [attr-defined]\n                and is_interval_dtype(\n                    self.categories.dtype  # type: ignore[attr-defined]\n                )\n            )\n    \n            if nmissing == len(indexer):\n                if use_interval_msg:\n                    key = list(key)\n                raise KeyError(f\"None of [{key}] are in the [{axis_name}]\")\n    \n            not_found = list(ensure_index(key)[missing_mask.nonzero()[0]].unique())\n>           raise KeyError(f\"{not_found} not in index\")\nE           KeyError: \"['Min BS (kg)'] not in index\"\n\nvenv\\Lib\\site-packages\\pandas\\core\\indexes\\base.py:5941: KeyError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"login","time":{"start":1708258234523,"stop":1708258234954,"duration":431},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentsCount":0,"shouldDisplayMessage":false,"hasContent":false,"attachmentStep":false,"stepsCount":0},{"name":"get_facility","time":{"start":1708258234954,"stop":1708258235780,"duration":826},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentsCount":0,"shouldDisplayMessage":false,"hasContent":false,"attachmentStep":false,"stepsCount":0}],"testStage":{"description":"This test case test API to validate the master data snapshot report for productions with excelfile data","status":"broken","statusMessage":"KeyError: \"['Min BS (kg)'] not in index\"","statusTrace":"self = <test_audit_portal_formulation_facility.TestAuditPortalLimits object at 0x000002B7B519CB90>\n\n    @allure.title(\"Validate master data snapshot report for Productions\")\n    @allure.description(\"This test case test API to validate the master data snapshot report for productions with excel\"\n                        \"file data\")\n    @allure.link(\"https://app.clickup.com/t/85zt9qzdn\")\n    @pytest.mark.formulation\n    @pytest.mark.validate_master_data_snapshot_report_productions\n    def test_validate_master_data_snapshot_report_productions(self):\n        data = {}\n        mismatched_rows = []\n        assert_flag = False\n    \n        data.update({\"sheet_name\": \"Productions\"})\n    \n        master_data_snapshot = self.get_audit_portal.test_config_new_master_data_snapshot_report(data)[\"response\"]\n    \n        if master_data_snapshot:\n            master_data_snapshot = pd.json_normalize(master_data_snapshot)\n    \n            columns_mapping = {\"externalId\": \"Production Id\", \"batchSize\": \"Min BS (kg)\",\n                               \"productId\": \"Product Id\", \"totalInsolubleLoad\": \"Total Insoluble Load\"}\n    \n            excel_data = pd.read_excel(const.get_master_data(), sheet_name=\"production\", usecols='A:D', nrows=39)\n            allure.attach(excel_data.to_html(), name=\"excel_data\", attachment_type=allure.attachment_type.HTML)\n    \n            api_df = master_data_snapshot[columns_mapping.keys()]\n>           excel_df = excel_data[columns_mapping.values()]\n\ntests\\scenarios\\test_audit_portal_formulation_facility.py:416: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\nvenv\\Lib\\site-packages\\pandas\\core\\frame.py:3767: in __getitem__\n    indexer = self.columns._get_indexer_strict(key, \"columns\")[1]\nvenv\\Lib\\site-packages\\pandas\\core\\indexes\\base.py:5877: in _get_indexer_strict\n    self._raise_if_missing(keyarr, indexer, axis_name)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = Index(['Production Id', 'Product Id', 'Min BS (L)', 'Total Insoluble Load'], dtype='object')\nkey = Index(['Production Id', 'Min BS (kg)', 'Product Id', 'Total Insoluble Load'], dtype='object'), indexer = array([ 0, -1,  1,  3], dtype=int64), axis_name = 'columns'\n\n    def _raise_if_missing(self, key, indexer, axis_name: str_t) -> None:\n        \"\"\"\n        Check that indexer can be used to return a result.\n    \n        e.g. at least one element was found,\n        unless the list of keys was actually empty.\n    \n        Parameters\n        ----------\n        key : list-like\n            Targeted labels (only used to show correct error message).\n        indexer: array-like of booleans\n            Indices corresponding to the key,\n            (with -1 indicating not found).\n        axis_name : str\n    \n        Raises\n        ------\n        KeyError\n            If at least one key was requested but none was found.\n        \"\"\"\n        if len(key) == 0:\n            return\n    \n        # Count missing values\n        missing_mask = indexer < 0\n        nmissing = missing_mask.sum()\n    \n        if nmissing:\n            # TODO: remove special-case; this is just to keep exception\n            #  message tests from raising while debugging\n            use_interval_msg = is_interval_dtype(self.dtype) or (\n                is_categorical_dtype(self.dtype)\n                # \"Index\" has no attribute \"categories\"  [attr-defined]\n                and is_interval_dtype(\n                    self.categories.dtype  # type: ignore[attr-defined]\n                )\n            )\n    \n            if nmissing == len(indexer):\n                if use_interval_msg:\n                    key = list(key)\n                raise KeyError(f\"None of [{key}] are in the [{axis_name}]\")\n    \n            not_found = list(ensure_index(key)[missing_mask.nonzero()[0]].unique())\n>           raise KeyError(f\"{not_found} not in index\")\nE           KeyError: \"['Min BS (kg)'] not in index\"\n\nvenv\\Lib\\site-packages\\pandas\\core\\indexes\\base.py:5941: KeyError","steps":[],"attachments":[{"uid":"b42e7577f0bce3fc","name":"excel_data","source":"b42e7577f0bce3fc.html","type":"text/html","size":5205}],"parameters":[],"attachmentsCount":1,"shouldDisplayMessage":true,"hasContent":true,"attachmentStep":false,"stepsCount":0},"afterStages":[],"labels":[{"name":"tag","value":"validate_master_data_snapshot_report_productions"},{"name":"tag","value":"formulation"},{"name":"tag","value":"run(order=1)"},{"name":"tag","value":"audit_portal_limits"},{"name":"tag","value":"scenario"},{"name":"tag","value":"second"},{"name":"parentSuite","value":"tests.scenarios"},{"name":"suite","value":"test_audit_portal_formulation_facility"},{"name":"subSuite","value":"TestAuditPortalLimits"},{"name":"host","value":"DESKTOP-ESU2KLG"},{"name":"thread","value":"12592-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.scenarios.test_audit_portal_formulation_facility"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[{"name":"https://app.clickup.com/t/85zt9qzdn","url":"https://app.clickup.com/t/85zt9qzdn","type":"link"}],"hidden":true,"retry":true,"extra":{"categories":[],"tags":["validate_master_data_snapshot_report_productions","scenario","run(order=1)","formulation","audit_portal_limits","second"]},"source":"a2faab0215bd9057.json","parameterValues":[]}